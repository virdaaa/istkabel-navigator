<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üß∂ –ò—Å—Ç–∫–∞–±–µ–ª—å –ì–∏–¥</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body, #app { height: 100%; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a !important;
            color: #ffffff !important;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            overflow-x: hidden;
        }
        .min-h-screen { min-height: 100vh; min-height: -webkit-fill-available; }
        .btn-primary {
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            color: #fff !important;
        }
        .btn-primary:active { transform: scale(0.98); }
        .entrance-btn { color: #fff !important; }
        .entrance-btn:active { transform: scale(0.98); }
        .place-btn { background: #1f2937 !important; color: #fff !important; }
        .place-btn div { color: #fff !important; }
        .place-btn .text-gray-400 { color: #9ca3af !important; }
        header { background: #111827 !important; border-color: #1f2937 !important; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .loader { border: 4px solid rgba(255,255,255,0.1); border-top-color: #f97316; border-radius: 50%; width: 48px; height: 48px; }
        .route-photo { background: #111827; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Telegram WebApp init (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤–Ω–µ Telegram)
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        // –î–∞–Ω–Ω—ã–µ
        const GITHUB_PHOTOS = 'https://virdaaa.github.io/istkabel-navigator/images/route1-coworking/';

        const ENTRANCES = [
            { id: 'kozh-34zh', name: '–ö–æ–∂–µ–≤–µ–Ω–Ω–∞—è 34–∂', color: '#8b5cf6', x: 7, y: 68 },
            { id: 'dom-byta', name: '–î–æ–º –±—ã—Ç–∞', color: '#3b82f6', x: 48, y: 78 },
            { id: 'sevcable', name: '–û—Ç –°–µ–≤–∫–∞–±–µ–ª—è', color: '#14b8a6', x: 90, y: 58 },
        ];

        const LANDMARKS = [
            { id: 'kozh-line', name: '–ö–æ–∂–µ–≤–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è', icon: 'üõ£Ô∏è', x: 41.5, y: 87.7 },
            { id: 'katok', name: '–ö–∞—Ç–æ–∫', icon: '‚õ∏Ô∏è', x: 88.1, y: 37.5 },
            { id: 'bar-line', name: '–ë–∞—Ä–Ω–∞—è –ª–∏–Ω–∏—è', icon: 'üç∫', x: 43.5, y: 9.2 },
            { id: 'zaliv', name: '–§–∏–Ω—Å–∫–∏–π –∑–∞–ª–∏–≤', icon: 'üåä', x: 43.5, y: 2.2 },
            { id: 'pereulok', name: '–ù–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—É–ª–æ–∫', icon: 'üö∂', x: 8.2, y: 49.9 },
        ];

        const PLACES = [
            // 1 –≠–¢–ê–ñ
            // { id: 'machty', name: '–ú–∞—á—Ç—ã', icon: 'üç∏', floor: 1, category: '–ë–∞—Ä' },
            // { id: 'nado-podumat', name: '–ù–∞–¥–æ –ø–æ–¥—É–º–∞—Ç—å', icon: 'üí®', floor: 1, category: '–ö–∞–ª—å—è–Ω–Ω–∞—è' },
            // { id: 'wodovorot', name: 'Wodovorot', icon: 'üí™', floor: 1, category: '–°–ø–æ—Ä—Ç' },
            // { id: 'barnaya', name: '–ë–∞—Ä–Ω–∞—è –ª–∏–Ω–∏—è', icon: 'üç∫', floor: 1, category: '–ë–∞—Ä—ã' },
            // { id: 'ritmy', name: '–†–∏—Ç–º—ã', icon: 'üéµ', floor: 1, category: '–ö–ª—É–±' },
            // 2 –≠–¢–ê–ñ
            { id: 'svalka', name: 'SVALKA', icon: 'üëï', floor: 2, category: '–°–µ–∫–æ–Ω–¥-—Ö–µ–Ω–¥' },
            // { id: 'nami', name: 'NAMI', icon: 'üì∑', floor: 2, category: '–§–æ—Ç–æ—Å—Ç—É–¥–∏—è' },
            // { id: 'loft-port', name: '–õ–æ—Ñ—Ç –ü–æ—Ä—Ç', icon: 'üè†', floor: 2, category: '–õ–æ—Ñ—Ç' },
            // { id: 'skellige', name: '–°–∫–µ–ª–ª–∏–≥–µ', icon: 'ü™ì', floor: 2, category: '–¢–æ–ø–æ—Ä—ã' },
            // 3 –≠–¢–ê–ñ
            // { id: 'metod', name: '–ú–µ—Ç–æ–¥', icon: 'üé≠', floor: 3, category: '–ö–≤–µ—Å—Ç' },
        ];

        const ROUTE_KOZH_SVALKA = [
            { id: 1, photo: GITHUB_PHOTOS + 'IMG_9343.JPG', text: '–í—Ö–æ–¥ —Å –ö–æ–∂–µ–≤–µ–Ω–Ω–æ–π 34–ñ', hint: '–ü–æ—Å–ª–µ —à–ª–∞–≥–±–∞—É–º–∞ —Å—Ä–∞–∑—É –Ω–∞–ø—Ä–∞–≤–æ', direction: 'forward' },
            { id: 2, photo: GITHUB_PHOTOS + 'IMG_9342.JPG', text: '–ó–∞—Ö–æ–¥–∏—Ç–µ –≤ —ç—Ç—É –¥–≤–µ—Ä—å', hint: '–î–≤–µ—Ä—å —Å –Ω–æ–º–µ—Ä–æ–º 3105', direction: 'forward' },
            { id: 3, photo: GITHUB_PHOTOS + 'IMG_9341.JPG', text: '–ü—Ä—è–º–æ –∏ –Ω–∞–ª–µ–≤–æ', hint: '–°–ª–µ–¥—É–π—Ç–µ —É–∫–∞–∑–∞—Ç–µ–ª—è–º', direction: 'left' },
            { id: 4, photo: GITHUB_PHOTOS + 'IMG_9340.JPG', text: '–ü—Ä—è–º–æ –ø–æ –∫–æ—Ä–∏–¥–æ—Ä—É', hint: '–°–ø—Ä–∞–≤–∞ –±—É–¥–µ—Ç –ª–µ—Å—Ç–Ω–∏—Ü–∞', direction: 'forward' },
            { id: 5, photo: GITHUB_PHOTOS + 'IMG_9339.JPG', text: '–í—Ö–æ–¥ –Ω–∞ –ª–µ—Å—Ç–Ω–∏—Ü—É', hint: '–ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞–≤–µ—Ä—Ö', direction: 'up' },
            { id: 6, photo: GITHUB_PHOTOS + 'IMG_9338.JPG', text: '–ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è', hint: '–ù–∞ –≤—Ç–æ—Ä–æ–π —ç—Ç–∞–∂', direction: 'up' },
            { id: 7, photo: GITHUB_PHOTOS + 'IMG_9337.JPG', text: '–í—Ç–æ—Ä–æ–π —ç—Ç–∞–∂ ‚Äî –Ω–∞–ª–µ–≤–æ', hint: '–£–∫–∞–∑–∞—Ç–µ–ª–∏ SVALKA', direction: 'left' },
            { id: 8, photo: GITHUB_PHOTOS + 'IMG_9336.JPG', text: '–í —ç—Ç–æ—Ç –ø—Ä–æ—Ö–æ–¥', hint: '–ü–æ—á—Ç–∏ –ø—Ä–∏—à–ª–∏!', direction: 'forward' },
            { id: 9, photo: GITHUB_PHOTOS + 'IMG_9335.JPG', text: '–í—ã –Ω–∞ –º–µ—Å—Ç–µ!', hint: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SVALKA', direction: 'arrived', isFinal: true },
        ];

        const GITHUB_PHOTOS_DOMBYTA = 'https://virdaaa.github.io/istkabel-navigator/images/route2-dombyta/';
        
        const ROUTE_DOMBYTA_SVALKA = [
            { id: 1, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9356.JPG', text: '–í—Ö–æ–¥ "–î–æ–º –±—ã—Ç–∞"', hint: '–ó–∞—Ö–æ–¥–∏–º –≤–Ω—É—Ç—Ä—å', direction: 'forward' },
            { id: 2, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9357.JPG', text: '–í —Ö–æ–ª–ª–µ –Ω–∞–ª–µ–≤–æ', hint: '–°–ª–µ–¥—É–π—Ç–µ —É–∫–∞–∑–∞—Ç–µ–ª—è–º', direction: 'left' },
            { id: 3, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9358.JPG', text: '–ò–¥—ë–º –¥–æ –∫–æ–Ω—Ü–∞', hint: '–°–ª–µ–≤–∞ –º–∞–≥–∞–∑–∏–Ω, –ø–æ–≤–æ—Ä–æ—Ç –Ω–∞–ø—Ä–∞–≤–æ', direction: 'right' },
            { id: 4, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9360.JPG', text: '–ü—Ä—è–º–æ –¥–æ –∫–∞—Ä—Ç—ã', hint: '–ù–∞–ª–µ–≤–æ –±—É–¥–µ—Ç –¥–≤–µ—Ä—å', direction: 'left' },
            { id: 5, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9361.JPG', text: '–û—Ç–∫—Ä—ã–≤–∞–µ–º —ç—Ç—É –¥–≤–µ—Ä—å', hint: '–ú–∞–ª–µ–Ω—å–∫–∞—è –¥–≤–µ—Ä—å —Å "–í—ã—Ö–æ–¥"', direction: 'forward' },
            { id: 6, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9362.JPG', text: '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –¥–≤–æ—Ä', hint: '–ù–∞–ø—Ä–∞–≤–æ, –∑–∞—Ç–µ–º —Å—Ä–∞–∑—É –Ω–∞–ª–µ–≤–æ', direction: 'right' },
            { id: 7, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9363.JPG', text: '–ü–µ—Ä–µ—É–ª–æ–∫ —Å –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏', hint: '–ì—Ä–∞—Ñ—Ñ–∏—Ç–∏ —Å–ø—Ä–∞–≤–∞', direction: 'forward' },
            { id: 8, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9364.JPG', text: '–î–≤–µ—Ä—å —Å –∫—Ä—É–≥–ª—ã–º–∏ –æ–∫–Ω–∞–º–∏', hint: '–°–ø—Ä–∞–≤–∞ –≤—Ö–æ–¥', direction: 'right' },
            { id: 9, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9365.JPG', text: '–ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –ø–æ –ª–µ—Å—Ç–Ω–∏—Ü–µ', hint: '–ù–∞ —Å—Ç–µ–Ω–µ "–ù–µ–≤–∏–¥–∏–º—ã–π"', direction: 'up' },
            { id: 10, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9367.JPG', text: '–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–¥—ä—ë–º', hint: '–ù–∞ –≤—Ç–æ—Ä–æ–π —ç—Ç–∞–∂', direction: 'up' },
            { id: 11, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9368.JPG', text: '–î–≤–µ—Ä—å "–¢–µ–∞—Ç—Ä"', hint: '–ó–∞—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–∏–¥–æ—Ä', direction: 'forward' },
            { id: 12, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9369.JPG', text: '–ö–æ—Ä–∏–¥–æ—Ä –ù–µ–≤–∏–¥–∏–º—ã–π —Ç–µ–∞—Ç—Ä', hint: '–ü—Ä–æ—Ö–æ–¥–∏–º –Ω–∞—Å–∫–≤–æ–∑—å, –≤ –∫–æ–Ω—Ü–µ –Ω–∞–ª–µ–≤–æ', direction: 'left' },
            { id: 13, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9370.JPG', text: '–î–ª–∏–Ω–Ω—ã–π –∫–æ—Ä–∏–¥–æ—Ä', hint: '–ò–¥—ë–º –¥–æ –ø–æ–≤–æ—Ä–æ—Ç–∞ –Ω–∞–ø—Ä–∞–≤–æ', direction: 'forward' },
            { id: 14, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9371.JPG', text: '–ü–æ–≤–æ—Ä–æ—Ç –Ω–∞–ø—Ä–∞–≤–æ', hint: '–ó–¥–µ—Å—å –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º', direction: 'right' },
            { id: 15, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9372.JPG', text: '–ò–¥—ë–º –ø—Ä—è–º–æ!', hint: '–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—É—Ç—å', direction: 'forward' },
            { id: 16, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9373.JPG', text: '–í—Å—ë –µ—â—ë –∏–¥—ë–º!', hint: '–ù–∞–º –¥–æ –∫–æ–Ω—Ü–∞', direction: 'forward' },
            { id: 17, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9374.JPG', text: '–ü–æ—á—Ç–∏ –ø—Ä–∏—à–ª–∏', hint: '–ò–¥—ë–º –¥–∞–ª—å—à–µ', direction: 'forward' },
            { id: 18, photo: GITHUB_PHOTOS_DOMBYTA + 'IMG_9375.JPG', text: '–§–∏–Ω–∏—à ‚Äî SVALKA!', hint: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', direction: 'arrived', isFinal: true },
        ];

        const GITHUB_PHOTOS_SEVCABLE = 'images/route3-sevcable/';
        
        const ROUTE_SEVCABLE_SVALKA = [
            { id: 1, photo: GITHUB_PHOTOS_SEVCABLE + 'step01.jpg', text: '–ü–∞—Ä–∫–æ–≤–∫–∞', hint: '–ò–¥—ë–º –ø—Ä—è–º–æ –¥–æ –∫–æ–Ω—Ü–∞ –≤ —É–≥–æ–ª', direction: 'forward' },
            { id: 2, photo: GITHUB_PHOTOS_SEVCABLE + 'step02.jpg', text: '–ò–¥—ë–º –≤ —É–≥–æ–ª', hint: '–ü—Ä—è–º–æ –ø–æ –ø–µ—Ä–µ—É–ª–∫—É', direction: 'forward' },
            { id: 3, photo: GITHUB_PHOTOS_SEVCABLE + 'step03.jpg', text: '–î–∞–ª—å—à–µ –ø—Ä—è–º–æ', hint: '–ö –∫—Ä–∞—Å–Ω–æ–º—É –∑–¥–∞–Ω–∏—é', direction: 'forward' },
            { id: 4, photo: GITHUB_PHOTOS_SEVCABLE + 'step04.jpg', text: '–ò–¥—ë–º –ø—Ä—è–º–æ', hint: '–°–ª–µ–≤–∞ –≥—Ä–∞—Ñ—Ñ–∏—Ç–∏', direction: 'forward' },
            { id: 5, photo: GITHUB_PHOTOS_SEVCABLE + 'step05.jpg', text: '–ü—Ä—è–º–æ. –ü–æ—á—Ç–∏', hint: '–ü–æ–¥ –≥–∏—Ä–ª—è–Ω–¥–∞–º–∏', direction: 'forward' },
            { id: 6, photo: GITHUB_PHOTOS_SEVCABLE + 'step06.jpg', text: '–û—Ä–∞–Ω–∂–µ–≤—ã–µ –≤–æ—Ä–æ—Ç–∞', hint: '–í—Ö–æ–¥–∏–º', direction: 'forward' },
            { id: 7, photo: GITHUB_PHOTOS_SEVCABLE + 'step07.jpg', text: '–°–ª–µ–≤–∞ –ª–µ—Å—Ç–Ω–∏—Ü–∞ –Ω–∞–≤–µ—Ä—Ö', hint: '–ù–∞–º –Ω–∞ –Ω–µ—ë', direction: 'left' },
            { id: 8, photo: GITHUB_PHOTOS_SEVCABLE + 'step08.jpg', text: '–ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è', hint: '–ù–∞ –≤—Ç–æ—Ä–æ–π —ç—Ç–∞–∂', direction: 'up' },
            { id: 9, photo: GITHUB_PHOTOS_SEVCABLE + 'step09.jpg', text: '–û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–≤–µ—Ä—å', hint: '–ù–∞–º –≤–Ω—É—Ç—Ä—å –∏ –Ω–∞–ª–µ–≤–æ', direction: 'left' },
            { id: 10, photo: GITHUB_PHOTOS_SEVCABLE + 'step10.jpg', text: '–ò–¥—ë–º –ø–æ –∫–æ—Ä–∏–¥–æ—Ä—É', hint: '–ü—Ä—è–º–æ', direction: 'forward' },
            { id: 11, photo: GITHUB_PHOTOS_SEVCABLE + 'step11.jpg', text: '–ò –¥–∞–ª—å—à–µ', hint: '–ü–æ—á—Ç–∏ –ø—Ä–∏—à–ª–∏', direction: 'forward' },
            { id: 12, photo: GITHUB_PHOTOS_SEVCABLE + 'step12.jpg', text: '–§–∏–Ω–∏—à ‚Äî SVALKA!', hint: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', direction: 'arrived', isFinal: true },
        ];

        // –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∞
        function getRoute(entranceId, placeId) {
            if (entranceId === 'kozh-34zh' && placeId === 'svalka') return ROUTE_KOZH_SVALKA;
            if (entranceId === 'dom-byta' && placeId === 'svalka') return ROUTE_DOMBYTA_SVALKA;
            if (entranceId === 'sevcable' && placeId === 'svalka') return ROUTE_SEVCABLE_SVALKA;
            return null;
        }

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let state = {
            screen: 'places',  // –ù–∞—á–∏–Ω–∞–µ–º —Å –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç–∞
            entrance: null,
            place: null,
            step: 1,
            searchQuery: ''
        };

        // –ò–∫–æ–Ω–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
        const directionIcons = { forward: '‚û°Ô∏è', left: '‚¨ÖÔ∏è', right: '‚û°Ô∏è', up: '‚¨ÜÔ∏è', down: '‚¨áÔ∏è', arrived: 'üìç' };

        // –†–µ–Ω–¥–µ—Ä
        function render() {
            const app = document.getElementById('app');
            
            if (state.screen === 'places') {
                app.innerHTML = renderPlacesScreen();
            } else if (state.screen === 'map') {
                app.innerHTML = renderMapScreen();
            } else if (state.screen === 'route') {
                app.innerHTML = renderRouteScreen();
            }
            
            attachEvents();
        }

        function renderPlacesScreen() {
            const filteredPlaces = PLACES.filter(p => 
                p.name.toLowerCase().includes(state.searchQuery.toLowerCase())
            );
            
            return `
                <div class="min-h-screen flex flex-col" style="background: #0a0a0a;">
                    <header class="p-4 border-b flex items-center gap-3" style="background: #111827; border-color: #1f2937;">
                        <span class="text-2xl">üìç</span>
                        <span class="font-bold" style="color: #ffffff;">–ò—Å—Ç–∫–∞–±–µ–ª—å ‚Äî –∫—É–¥–∞ –∏–¥—ë–º?</span>
                    </header>
                    
                    <main class="flex-1 p-4">
                        <!-- –ü–æ–∏—Å–∫ -->
                        <div class="mb-4">
                            <input 
                                type="text" 
                                id="search-input"
                                placeholder="üîç –ù–∞–π—Ç–∏..."
                                value="${state.searchQuery}"
                                class="w-full p-3 rounded-xl border-0 outline-none"
                                style="background: #374151; color: #fff; font-weight: 500;"
                            />
                        </div>
                        
                        <!-- –°–ø–∏—Å–æ–∫ –º–µ—Å—Ç –ø–æ —ç—Ç–∞–∂–∞–º -->
                        <div class="space-y-4">
                            ${[1, 2, 3].map(floor => {
                                const placesOnFloor = filteredPlaces.filter(p => p.floor === floor);
                                if (placesOnFloor.length === 0) return '';
                                return `
                                    <div>
                                        <div class="text-xs text-gray-500 mb-2">${floor} –≠–¢–ê–ñ</div>
                                        <div class="space-y-2">
                                            ${placesOnFloor.map(p => `
                                                <button 
                                                    class="place-select-btn w-full p-4 rounded-xl flex items-center justify-between"
                                                    data-place="${p.id}"
                                                    style="background: #1f2937;"
                                                >
                                                    <div class="flex items-center gap-3">
                                                        <span class="text-2xl">${p.icon}</span>
                                                        <div class="text-left">
                                                            <div class="font-bold" style="color: #fff;">${p.name}</div>
                                                            <div class="text-sm" style="color: #9ca3af;">${p.category || '–í–∏–Ω—Ç–∞–∂'}</div>
                                                        </div>
                                                    </div>
                                                    <span style="color: #6b7280;">‚Üí</span>
                                                </button>
                                            `).join('')}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderMapScreen() {
            return `
                <div class="min-h-screen flex flex-col" style="background: #0a0a0a;">
                    <header class="p-4 border-b flex items-center gap-3" style="background: #111827; border-color: #1f2937;">
                        <button class="back-to-places text-xl" style="color: #9ca3af;">‚Üê</button>
                        <span class="text-2xl">${state.place?.icon || 'üìç'}</span>
                        <span class="font-bold" style="color: #ffffff;">–ò–¥—ë–º –≤ ${state.place?.name || ''}</span>
                    </header>
                    
                    <main class="flex-1 p-4">
                        <h2 class="text-xl font-bold text-center mb-4" style="color: #ffffff;">–û—Ç–∫—É–¥–∞ –≤—ã –∑–∞—Ö–æ–¥–∏—Ç–µ?</h2>
                        
                        <div class="relative rounded-xl overflow-hidden border border-gray-700 mb-4" style="background: #111827;">
                            <!-- –§–æ—Ç–æ –∫–∞—Ä—Ç—ã -->
                            <img 
                                src="map.webp" 
                                alt="–ö–∞—Ä—Ç–∞ –ò—Å—Ç–∫–∞–±–µ–ª—å"
                                class="w-full h-auto"
                                style="display: block;"
                            />
                            
                            <!-- –ù–∞–¥–ø–∏—Å—å –ë–∞—Ä–Ω–∞—è –ª–∏–Ω–∏—è -->
                            <div class="absolute text-center" style="left: 50%; top: 18%; transform: translateX(-50%); color: #374151; font-size: 36px; font-weight: 500;">–ë–∞—Ä–Ω–∞—è –ª–∏–Ω–∏—è</div>
                            
                            <!-- –í—Ö–æ–¥—ã -->
                            ${ENTRANCES.map(e => `
                                <button 
                                    class="entrance-marker absolute transform -translate-x-1/2 -translate-y-1/2 transition-transform hover:scale-110"
                                    data-entrance="${e.id}"
                                    style="left: ${e.x}%; top: ${e.y}%"
                                >
                                    <div class="w-9 h-9 rounded-full border-2 border-white flex items-center justify-center text-base shadow-lg" style="background: ${e.color}">üö™</div>
                                    <div class="absolute top-10 left-1/2 -translate-x-1/2 text-xs px-2 py-1 rounded whitespace-nowrap font-medium shadow-lg" style="background: ${e.color}; color: #fff;">${e.name}</div>
                                </button>
                            `).join('')}
                        </div>
                        
                        <div class="space-y-2">
                            ${ENTRANCES.map(e => `
                                <button 
                                    class="entrance-btn w-full p-4 rounded-xl text-left font-bold transition-transform"
                                    data-entrance="${e.id}"
                                    style="background: ${e.color}; color: #ffffff;"
                                >${e.name}</button>
                            `).join('')}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderRouteScreen() {
            const route = getRoute(state.entrance.id, state.place.id);
            if (!route) {
                return `
                    <div class="min-h-screen flex flex-col items-center justify-center p-4" style="background: #0a0a0a;">
                        <div class="text-6xl mb-4">üöß</div>
                        <div class="text-xl font-bold text-white mb-2">–ú–∞—Ä—à—Ä—É—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div>
                        <div class="text-gray-400 text-center mb-4">–ü–æ–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –º–∞—Ä—à—Ä—É—Ç—ã –¥–æ SVALKA –æ—Ç –ö–æ–∂–µ–≤–µ–Ω–Ω–æ–π 34–∂ –∏ –î–æ–º–∞ –±—ã—Ç–∞</div>
                        <button class="back-btn px-6 py-3 rounded-xl bg-gray-700 text-white">‚Üê –ù–∞–∑–∞–¥</button>
                    </div>
                `;
            }
            const currentStep = route[state.step - 1];
            const isFirst = state.step === 1;
            const isLast = state.step === route.length;

            return `
                <div class="min-h-screen flex flex-col">
                    <header class="p-4 border-b border-gray-800 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <button class="back-btn text-gray-400 text-xl">‚Üê</button>
                            <span class="text-2xl">üß∂</span>
                        </div>
                        <div class="text-sm text-gray-400">${state.entrance.name} ‚Üí ${state.place.name}</div>
                        <button class="home-btn text-xl">üè†</button>
                    </header>
                    
                    <div class="h-1 bg-gray-800">
                        <div class="h-full btn-primary transition-all duration-300" style="width: ${(state.step / route.length) * 100}%"></div>
                    </div>
                    
                    <main class="flex-1 flex flex-col overflow-hidden">
                        <div class="relative route-photo" style="flex: 1 1 auto; min-height: 180px; max-height: 50vh;">
                            <div class="photo-loader absolute inset-0 flex items-center justify-center">
                                <div class="loader animate-spin"></div>
                            </div>
                            <img 
                                src="${currentStep.photo}" 
                                alt="${currentStep.text}"
                                class="absolute inset-0 w-full h-full object-cover"
                                crossorigin="anonymous"
                                onload="this.style.opacity=1; this.parentElement.querySelector('.photo-loader').style.display='none';"
                                onerror="this.parentElement.querySelector('.photo-loader').innerHTML='<div class=\\'text-center\\'><div class=\\'text-4xl mb-2\\'>üì∑</div><div class=\\'text-gray-400 text-sm\\'>–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div></div>';"
                                style="opacity: 0; transition: opacity 0.3s"
                            />
                            
                            <div class="absolute top-2 left-2 bg-black/60 backdrop-blur rounded-full px-2 py-1 text-sm">
                                <span class="text-orange-400 font-bold">${state.step}</span>
                                <span class="text-gray-400">/${route.length}</span>
                            </div>
                            
                            <div class="absolute top-2 right-2 bg-black/60 backdrop-blur rounded-full w-8 h-8 flex items-center justify-center text-lg">
                                ${directionIcons[currentStep.direction]}
                            </div>
                            
                            ${isLast ? `
                                <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                                    <div class="text-center animate-bounce">
                                        <div class="text-5xl">üß∂</div>
                                        <div class="text-xl font-bold mt-2">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="p-3 bg-gray-900 border-t border-gray-800" style="flex-shrink: 0;">
                            <div class="flex items-start gap-2 mb-3 bg-gray-800 rounded-xl p-2">
                                <div class="text-2xl">${directionIcons[currentStep.direction]}</div>
                                <div>
                                    <div class="font-bold text-white">${currentStep.text}</div>
                                    <div class="text-gray-300 text-sm">${currentStep.hint}</div>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button 
                                    class="prev-btn flex-1 py-4 rounded-xl bg-gray-700 font-medium text-lg ${isFirst ? 'opacity-30' : ''}"
                                    style="color: #fff;"
                                    ${isFirst ? 'disabled' : ''}
                                >‚Üê –ù–∞–∑–∞–¥</button>
                                <button 
                                    class="next-btn flex-1 py-4 rounded-xl btn-primary font-bold text-lg"
                                    style="${isLast ? 'background: #16a34a;' : ''}"
                                >${isLast ? 'üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é' : '–î–∞–ª—å—à–µ ‚Üí'}</button>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        function attachEvents() {
            // –ü–æ–∏—Å–∫ –º–µ—Å—Ç
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.oninput = (e) => {
                    state.searchQuery = e.target.value;
                    render();
                    // –§–æ–∫—É—Å –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –ø–æ–ª–µ
                    setTimeout(() => {
                        const input = document.getElementById('search-input');
                        if (input) {
                            input.focus();
                            input.setSelectionRange(input.value.length, input.value.length);
                        }
                    }, 0);
                };
            }

            // –í—ã–±–æ—Ä –º–µ—Å—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
            document.querySelectorAll('.place-select-btn').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.dataset.place;
                    state.place = PLACES.find(p => p.id === id);
                    state.screen = 'map';
                    render();
                };
            });

            // –í—ã–±–æ—Ä –≤—Ö–æ–¥–∞ –Ω–∞ –∫–∞—Ä—Ç–µ
            document.querySelectorAll('[data-entrance]').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.dataset.entrance;
                    state.entrance = ENTRANCES.find(e => e.id === id);
                    state.step = 1;
                    state.screen = 'route';
                    render();
                };
            });

            // –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –º–µ—Å—Ç
            document.querySelectorAll('.back-to-places').forEach(btn => {
                btn.onclick = () => {
                    state.screen = 'places';
                    state.place = null;
                    render();
                };
            });

            // –ù–∞–∑–∞–¥ –≤ –º–∞—Ä—à—Ä—É—Ç–µ
            document.querySelectorAll('.back-btn').forEach(btn => {
                btn.onclick = () => {
                    if (state.screen === 'route') {
                        state.screen = 'map';
                        state.entrance = null;
                        state.step = 1;
                    }
                    render();
                };
            });

            // –î–æ–º–æ–π (–Ω–∞ –≥–ª–∞–≤–Ω—É—é)
            document.querySelectorAll('.home-btn').forEach(btn => {
                btn.onclick = () => {
                    state.screen = 'places';
                    state.entrance = null;
                    state.place = null;
                    state.step = 1;
                    state.searchQuery = '';
                    render();
                };
            });

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–º
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            
            if (prevBtn) {
                prevBtn.onclick = () => {
                    if (state.step > 1) {
                        state.step--;
                        render();
                    }
                };
            }
            
            if (nextBtn) {
                nextBtn.onclick = () => {
                    const route = getRoute(state.entrance.id, state.place.id);
                    if (route && state.step < route.length) {
                        state.step++;
                        render();
                    } else if (route && state.step === route.length) {
                        // –§–∏–Ω–∏—à ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                        state.screen = 'places';
                        state.entrance = null;
                        state.place = null;
                        state.step = 1;
                        state.searchQuery = '';
                        render();
                    }
                };
            }
        }

        // –°—Ç–∞—Ä—Ç
        render();
    </script>
</body>
</html>
