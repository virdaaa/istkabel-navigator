<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üß∂ –ò—Å—Ç–∫–∞–±–µ–ª—å –ì–∏–¥</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a !important;
            color: #ffffff !important;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .btn-primary {
            background: linear-gradient(135deg, #ef4444 0%, #f97316 100%);
            color: #fff !important;
        }
        .btn-primary:active { transform: scale(0.98); }
        .entrance-btn { color: #fff !important; }
        .entrance-btn:active { transform: scale(0.98); }
        .place-btn { background: #1f2937 !important; color: #fff !important; }
        .place-btn div { color: #fff !important; }
        .place-btn .text-gray-400 { color: #9ca3af !important; }
        header { background: #111827 !important; border-color: #1f2937 !important; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .animate-bounce { animation: bounce 1s infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .loader { border: 4px solid rgba(255,255,255,0.1); border-top-color: #f97316; border-radius: 50%; width: 48px; height: 48px; }
        .route-photo { background: #111827; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Telegram WebApp init
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // –î–∞–Ω–Ω—ã–µ
        const GITHUB_PHOTOS = 'https://virdaaa.github.io/istkabel-navigator/images/route1-coworking/';

        const ENTRANCES = [
            { id: 'dom-byta', name: '–î–æ–º –±—ã—Ç–∞', color: '#3b82f6', x: 57.2, y: 80.1 },
            { id: 'sevcable', name: '–û—Ç –°–µ–≤–∫–∞–±–µ–ª—è', color: '#14b8a6', x: 78.4, y: 48.7 },
            { id: 'kozh-34zh', name: '–ö–æ–∂–µ–≤–µ–Ω–Ω–∞—è 34–∂', color: '#8b5cf6', x: 12.8, y: 75.3 },
        ];

        const PLACES = [
            { id: 'svalka', name: 'SVALKA', icon: 'üëï', floor: 2 },
            { id: 'skellige', name: '–°–∫–µ–ª–ª–∏–≥–µ', icon: 'ü™ì', floor: 2 },
            { id: 'machty', name: '–ú–∞—á—Ç—ã', icon: 'üç∏', floor: 1 },
            { id: 'wodovorot', name: 'Wodovorot', icon: 'üí™', floor: 1 },
        ];

        const ROUTE_KOZH_SVALKA = [
            { id: 1, photo: GITHUB_PHOTOS + 'IMG_9343.JPG', text: '–í—Ö–æ–¥ —Å –ö–æ–∂–µ–≤–µ–Ω–Ω–æ–π 34–ñ', hint: '–ü–æ—Å–ª–µ —à–ª–∞–≥–±–∞—É–º–∞ —Å—Ä–∞–∑—É –Ω–∞–ø—Ä–∞–≤–æ', direction: 'forward' },
            { id: 2, photo: GITHUB_PHOTOS + 'IMG_9342.JPG', text: '–ó–∞—Ö–æ–¥–∏—Ç–µ –≤ —ç—Ç—É –¥–≤–µ—Ä—å', hint: '–î–≤–µ—Ä—å —Å –Ω–æ–º–µ—Ä–æ–º 3105', direction: 'forward' },
            { id: 3, photo: GITHUB_PHOTOS + 'IMG_9341.JPG', text: '–ü—Ä—è–º–æ –∏ –Ω–∞–ª–µ–≤–æ', hint: '–°–ª–µ–¥—É–π—Ç–µ —É–∫–∞–∑–∞—Ç–µ–ª—è–º', direction: 'left' },
            { id: 4, photo: GITHUB_PHOTOS + 'IMG_9340.JPG', text: '–ü—Ä—è–º–æ –ø–æ –∫–æ—Ä–∏–¥–æ—Ä—É', hint: '–°–ø—Ä–∞–≤–∞ –±—É–¥–µ—Ç –ª–µ—Å—Ç–Ω–∏—Ü–∞', direction: 'forward' },
            { id: 5, photo: GITHUB_PHOTOS + 'IMG_9339.JPG', text: '–í—Ö–æ–¥ –Ω–∞ –ª–µ—Å—Ç–Ω–∏—Ü—É', hint: '–ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è –Ω–∞–≤–µ—Ä—Ö', direction: 'up' },
            { id: 6, photo: GITHUB_PHOTOS + 'IMG_9338.JPG', text: '–ü–æ–¥–Ω–∏–º–∞–µ–º—Å—è', hint: '–ù–∞ –≤—Ç–æ—Ä–æ–π —ç—Ç–∞–∂', direction: 'up' },
            { id: 7, photo: GITHUB_PHOTOS + 'IMG_9337.JPG', text: '–í—Ç–æ—Ä–æ–π —ç—Ç–∞–∂ ‚Äî –Ω–∞–ª–µ–≤–æ', hint: '–£–∫–∞–∑–∞—Ç–µ–ª–∏ SVALKA', direction: 'left' },
            { id: 8, photo: GITHUB_PHOTOS + 'IMG_9336.JPG', text: '–í —ç—Ç–æ—Ç –ø—Ä–æ—Ö–æ–¥', hint: '–ü–æ—á—Ç–∏ –ø—Ä–∏—à–ª–∏!', direction: 'forward' },
            { id: 9, photo: GITHUB_PHOTOS + 'IMG_9335.JPG', text: '–í—ã –Ω–∞ –º–µ—Å—Ç–µ!', hint: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ SVALKA', direction: 'arrived', isFinal: true },
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let state = {
            screen: 'map',
            entrance: null,
            place: null,
            step: 1
        };

        // –ò–∫–æ–Ω–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π
        const directionIcons = { forward: '‚û°Ô∏è', left: '‚¨ÖÔ∏è', right: '‚û°Ô∏è', up: '‚¨ÜÔ∏è', arrived: 'üìç' };

        // –†–µ–Ω–¥–µ—Ä
        function render() {
            const app = document.getElementById('app');
            
            if (state.screen === 'map') {
                app.innerHTML = renderMapScreen();
            } else if (state.screen === 'place') {
                app.innerHTML = renderPlaceScreen();
            } else if (state.screen === 'route') {
                app.innerHTML = renderRouteScreen();
            }
            
            attachEvents();
        }

        function renderMapScreen() {
            return `
                <div class="min-h-screen flex flex-col">
                    <header class="p-4 border-b border-gray-800 flex items-center gap-3">
                        <span class="text-2xl">üß∂</span>
                        <span class="font-bold">–ò—Å—Ç–∫–∞–±–µ–ª—å –ì–∏–¥</span>
                    </header>
                    
                    <main class="flex-1 p-4">
                        <h2 class="text-xl font-bold text-center mb-4">–û—Ç–∫—É–¥–∞ –≤—ã –∑–∞—Ö–æ–¥–∏—Ç–µ?</h2>
                        
                        <div class="relative rounded-xl overflow-hidden border border-gray-700 bg-gray-900 aspect-video mb-4">
                            <svg viewBox="0 0 100 62" class="w-full h-full">
                                <rect x="0" y="0" width="100" height="62" fill="#111827"/>
                                <rect x="15" y="15" width="60" height="40" rx="2" fill="#374151" opacity="0.3"/>
                                <text x="45" y="35" fill="#6b7280" font-size="4" text-anchor="middle">–ò–°–¢–ö–ê–ë–ï–õ–¨</text>
                            </svg>
                            ${ENTRANCES.map(e => `
                                <button 
                                    class="entrance-marker absolute transform -translate-x-1/2 -translate-y-1/2 transition-transform hover:scale-110"
                                    data-entrance="${e.id}"
                                    style="left: ${e.x}%; top: ${e.y}%"
                                >
                                    <div class="w-10 h-10 rounded-full border-2 border-white flex items-center justify-center text-lg shadow-lg" style="background: ${e.color}">üö™</div>
                                </button>
                            `).join('')}
                        </div>
                        
                        <div class="space-y-2">
                            ${ENTRANCES.map(e => `
                                <button 
                                    class="entrance-btn w-full p-4 rounded-xl text-left font-bold transition-transform"
                                    data-entrance="${e.id}"
                                    style="background: ${e.color}"
                                >${e.name}</button>
                            `).join('')}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderPlaceScreen() {
            return `
                <div class="min-h-screen flex flex-col">
                    <header class="p-4 border-b border-gray-800 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <button class="back-btn text-gray-400 text-xl">‚Üê</button>
                            <span class="text-2xl">üß∂</span>
                            <span class="font-bold">–ò—Å—Ç–∫–∞–±–µ–ª—å –ì–∏–¥</span>
                        </div>
                    </header>
                    
                    <main class="flex-1 p-4">
                        <div class="text-center mb-4">
                            <div class="text-gray-400 text-sm">–í—ã –∑–∞—Ö–æ–¥–∏—Ç–µ —á–µ—Ä–µ–∑</div>
                            <div class="text-xl font-bold" style="color: ${state.entrance.color}">${state.entrance.name}</div>
                        </div>
                        
                        <h2 class="text-lg font-bold mb-3">–ö—É–¥–∞ –∏–¥—ë–º?</h2>
                        
                        <div class="space-y-2">
                            ${PLACES.map(p => `
                                <button 
                                    class="place-btn w-full p-4 rounded-xl bg-gray-800 text-left flex items-center gap-3 transition-transform active:scale-98"
                                    data-place="${p.id}"
                                >
                                    <span class="text-3xl">${p.icon}</span>
                                    <div>
                                        <div class="font-bold">${p.name}</div>
                                        <div class="text-gray-400 text-sm">${p.floor} —ç—Ç–∞–∂</div>
                                    </div>
                                </button>
                            `).join('')}
                        </div>
                    </main>
                </div>
            `;
        }

        function renderRouteScreen() {
            const route = ROUTE_KOZH_SVALKA;
            const currentStep = route[state.step - 1];
            const isFirst = state.step === 1;
            const isLast = state.step === route.length;

            return `
                <div class="min-h-screen flex flex-col">
                    <header class="p-4 border-b border-gray-800 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <button class="back-btn text-gray-400 text-xl">‚Üê</button>
                            <span class="text-2xl">üß∂</span>
                        </div>
                        <div class="text-sm text-gray-400">${state.entrance.name} ‚Üí ${state.place.name}</div>
                    </header>
                    
                    <div class="h-1 bg-gray-800">
                        <div class="h-full btn-primary transition-all duration-300" style="width: ${(state.step / route.length) * 100}%"></div>
                    </div>
                    
                    <main class="flex-1 flex flex-col">
                        <div class="relative flex-1 route-photo min-h-[250px]">
                            <div class="photo-loader absolute inset-0 flex items-center justify-center">
                                <div class="loader animate-spin"></div>
                            </div>
                            <img 
                                src="${currentStep.photo}" 
                                alt="${currentStep.text}"
                                class="absolute inset-0 w-full h-full object-cover"
                                crossorigin="anonymous"
                                onload="this.style.opacity=1; this.parentElement.querySelector('.photo-loader').style.display='none';"
                                onerror="this.parentElement.querySelector('.photo-loader').innerHTML='<div class=\\'text-center\\'><div class=\\'text-4xl mb-2\\'>üì∑</div><div class=\\'text-gray-400 text-sm\\'>–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div></div>';"
                                style="opacity: 0; transition: opacity 0.3s"
                            />
                            
                            <div class="absolute top-3 left-3 bg-black/60 backdrop-blur rounded-full px-3 py-1 text-sm">
                                <span class="text-orange-400 font-bold">${state.step}</span>
                                <span class="text-gray-400">/${route.length}</span>
                            </div>
                            
                            <div class="absolute top-3 right-3 bg-black/60 backdrop-blur rounded-full w-10 h-10 flex items-center justify-center text-xl">
                                ${directionIcons[currentStep.direction]}
                            </div>
                            
                            ${isLast ? `
                                <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
                                    <div class="text-center animate-bounce">
                                        <div class="text-6xl">üß∂</div>
                                        <div class="text-2xl font-bold mt-2">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="p-4 bg-gray-900 border-t border-gray-800">
                            <div class="flex items-start gap-3 mb-4 bg-gray-800 rounded-xl p-3">
                                <div class="text-3xl">${directionIcons[currentStep.direction]}</div>
                                <div>
                                    <div class="text-lg font-bold text-white">${currentStep.text}</div>
                                    <div class="text-gray-300 text-sm">${currentStep.hint}</div>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button 
                                    class="prev-btn flex-1 py-3 rounded-xl bg-gray-700 font-medium ${isFirst ? 'opacity-30' : ''}"
                                    ${isFirst ? 'disabled' : ''}
                                >‚Üê –ù–∞–∑–∞–¥</button>
                                <button 
                                    class="next-btn flex-1 py-3 rounded-xl btn-primary font-bold ${isLast ? 'bg-green-600' : ''}"
                                    ${isLast ? 'disabled' : ''}
                                >${isLast ? '‚úì –ì–æ—Ç–æ–≤–æ' : '–î–∞–ª—å—à–µ ‚Üí'}</button>
                            </div>
                        </div>
                    </main>
                </div>
            `;
        }

        function attachEvents() {
            // –í—ã–±–æ—Ä –≤—Ö–æ–¥–∞
            document.querySelectorAll('[data-entrance]').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.dataset.entrance;
                    state.entrance = ENTRANCES.find(e => e.id === id);
                    state.screen = 'place';
                    render();
                };
            });

            // –í—ã–±–æ—Ä –º–µ—Å—Ç–∞
            document.querySelectorAll('[data-place]').forEach(btn => {
                btn.onclick = () => {
                    const id = btn.dataset.place;
                    state.place = PLACES.find(p => p.id === id);
                    state.step = 1;
                    state.screen = 'route';
                    render();
                };
            });

            // –ù–∞–∑–∞–¥
            document.querySelectorAll('.back-btn').forEach(btn => {
                btn.onclick = () => {
                    if (state.screen === 'place') {
                        state.screen = 'map';
                        state.entrance = null;
                    } else if (state.screen === 'route') {
                        state.screen = 'place';
                        state.place = null;
                    }
                    render();
                };
            });

            // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —à–∞–≥–∞–º
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            
            if (prevBtn) {
                prevBtn.onclick = () => {
                    if (state.step > 1) {
                        state.step--;
                        render();
                    }
                };
            }
            
            if (nextBtn) {
                nextBtn.onclick = () => {
                    if (state.step < ROUTE_KOZH_SVALKA.length) {
                        state.step++;
                        render();
                    }
                };
            }
        }

        // –°—Ç–∞—Ä—Ç
        render();
    </script>
</body>
</html>
